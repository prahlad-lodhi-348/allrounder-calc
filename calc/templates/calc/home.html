<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>AllRounder Calc</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Plot Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
    <!-- Polyfill -->
    <script src="https://cdn.jsdelivr.net/npm/babel-polyfill@6.26.0/dist/polyfill.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Custom CSS -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/math-keyboard.css' %}" rel="stylesheet">
    <link href="{% static 'css/modern-ui.css' %}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Main Content -->
            <main id="container" class="col-12">
                <!-- Top Controls -->
                <div class="top-controls">
                    <button class="control-btn" id="keyboard-btn" title="Open math keyboard">
                      ‚å®Ô∏è Keyboard
                    </button>
                </div>

                <!-- Main Calculator (Advanced Calculus) -->
                <div class="advanced-calc-card main-calculator">
                    <div class="section-header">
                      üßÆ Calculator - All Operations
                    </div>
                    <div class="calc-body">
                      <!-- Expression Input -->
                      <div class="form-group">
                        <label for="adv-expression">Expression:</label>
                        <textarea
                          id="adv-expression"
                          class="expression-textarea"
                          placeholder="Enter expression: e.g., sin(x), x**2 + y**2, log(x)*cos(y)"
                          rows="3"
                          autofocus
                        ></textarea>
                        <small class="hint">Supported variables: x, y, z, t | Use ** for power (e.g., x**2)</small>
                      </div>

                      <!-- Operation Selector -->
                      <div class="form-row">
                        <div class="form-group">
                          <label for="operation-select">Operation:</label>
                          <select id="operation-select" class="operation-dropdown">
                            <optgroup label="Basic Operations">
                              <option value="evaluate" selected>Evaluate (Calculate Result)</option>
                              <option value="simplify">Simplify</option>
                            </optgroup>
                            <optgroup label="Calculus Operations">
                              <option value="differentiate">Differentiate</option>
                              <option value="integrate">Integrate (Indefinite)</option>
                              <option value="definite_integral">Definite Integral</option>
                              <option value="partial_derivative">Partial Derivative</option>
                            </optgroup>
                            <optgroup label="Algebra Operations">
                              <option value="solve">Solve Equation</option>
                              <option value="expand">Expand</option>
                              <option value="factor">Factor</option>
                            </optgroup>
                            <optgroup label="Plotting">
                              <option value="plot_2d">Plot 2D Graph</option>
                              <option value="plot_3d">Plot 3D Surface</option>
                            </optgroup>
                            <optgroup label="Advanced">
                              <option value="series">Taylor Series</option>
                              <option value="limit">Limit</option>
                            </optgroup>
                          </select>
                        </div>
                        <div class="form-group" id="variable-group">
                          <label for="variable-select">With respect to:</label>
                          <select id="variable-select" class="variable-dropdown">
                            <option value="x" selected>x</option>
                            <option value="y">y</option>
                            <option value="z">z</option>
                            <option value="t">t</option>
                          </select>
                        </div>
                      </div>
                      <!-- Plot Settings (shown when Plot operation selected) -->
                      <div class="plot-settings" id="plot-settings-section" style="display: none;">
                        <h4>üìä Plot Settings</h4>
                        <div class="settings-grid">
                          <div class="form-group">
                            <label for="x-min">X min:</label>
                            <input type="number" id="x-min" value="-5" step="0.5" />
                          </div>
                          <div class="form-group">
                            <label for="x-max">X max:</label>
                            <input type="number" id="x-max" value="5" step="0.5" />
                          </div>
                          <div class="form-group">
                            <label for="y-min">Y min (for 3D):</label>
                            <input type="number" id="y-min" value="-5" step="0.5" />
                          </div>
                          <div class="form-group">
                            <label for="y-max">Y max (for 3D):</label>
                            <input type="number" id="y-max" value="5" step="0.5" />
                          </div>
                          <div class="form-group">
                            <label for="x-points">X Points:</label>
                            <input type="number" id="x-points" value="60" min="10" max="200" />
                          </div>
                          <div class="form-group">
                            <label for="y-points">Y Points:</label>
                            <input type="number" id="y-points" value="60" min="10" max="200" />
                          </div>
                        </div>
                      </div>
                      <!-- Action Buttons -->
                      <div class="action-buttons">
                        <button class="btn-execute" id="execute-btn">
                          üöÄ Execute
                        </button>
                        <button class="btn-execute btn-plot" id="plot-graph-btn">
                          üìà Plot Graph
                        </button>
                        <button class="btn-clear" id="clear-btn">
                          üóëÔ∏è Clear
                        </button>
                      </div>
                      <div class="results-area" id="results-display">
                        <h4>Results:</h4>
                        <div class="result-content" id="result-content">
                          Results will appear here after calculation...
                        </div>
                      </div>

                      <!-- Plot Container -->
                      <div id="plot-container" style="display: none;">
                        <div id="plot-loading" class="alert alert-info" style="display: none;">Generating plot...</div>
                        <canvas id="plot-canvas" style="display: none;"></canvas>
                        <div id="plotly-surface" class="plotly-surface" style="display: none;"></div>
                      </div>
                    </div>
                </div>



                <!-- Financial Calculators -->
                <div class="financial-calc-card">
                    <div class="section-header">
                      üí∞ Financial Calculators
                    </div>
                    <div class="calc-tabs">
                      <button class="calc-tab active" data-calc="simple-interest">
                        üìà Simple Interest
                      </button>
                      <button class="calc-tab" data-calc="compound-interest">
                        üí∞ Compound Interest
                      </button>
                      <button class="calc-tab" data-calc="currency-converter">
                        üí± Currency Converter
                      </button>
                    </div>
                    <div class="calc-content">
                      <div id="simple-interest-content" class="tab-content active">
                        <form id="si-form">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="si-principal" class="form-label">Principal:</label>
                                    <input type="number" id="si-principal" name="principal" min="0" step="any" required class="form-control">
                                </div>
                                <div class="col-md-4">
                                    <label for="si-rate" class="form-label">Rate (% per annum):</label>
                                    <input type="number" id="si-rate" name="rate" min="0" step="any" required class="form-control">
                                </div>
                                <div class="col-md-4">
                                    <label for="si-time" class="form-label">Time (years):</label>
                                    <input type="number" id="si-time" name="time" min="0" step="any" required class="form-control">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-calculator me-2"></i>Calculate</button>
                            <button type="button" class="btn btn-outline-info mt-2" id="si-plot-btn">
                              <i class="fas fa-chart-line me-2"></i>Plot Growth
                            </button>
                        </form>
                        <div id="si-result" class="result-box alert alert-success mt-3"></div>
                      </div>
                      <div id="compound-interest-content" class="tab-content">
                        <form id="ci-form">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label for="ci-principal" class="form-label">Principal:</label>
                                    <input type="number" id="ci-principal" name="principal" min="0" step="any" required class="form-control">
                                </div>
                                <div class="col-md-3">
                                    <label for="ci-rate" class="form-label">Rate (% per annum):</label>
                                    <input type="number" id="ci-rate" name="rate" min="0" step="any" required class="form-control">
                                </div>
                                <div class="col-md-3">
                                    <label for="ci-time" class="form-label">Time (years):</label>
                                    <input type="number" id="ci-time" name="time" min="0" step="any" required class="form-control">
                                </div>
                                <div class="col-md-3">
                                    <label for="ci-frequency" class="form-label">Compounding Frequency:</label>
                                    <input type="number" id="ci-frequency" name="frequency" min="1" step="1" required class="form-control">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-calculator me-2"></i>Calculate</button>
                            <button type="button" class="btn btn-outline-info mt-2" id="ci-plot-btn">
                              <i class="fas fa-chart-line me-2"></i>Plot Growth
                            </button>
                        </form>
                        <div id="ci-result" class="result-box alert alert-success mt-3" style="display: none;"></div>
                      </div>
                      <div id="currency-converter-content" class="tab-content">
                        <form id="currency-form" class="currency-form">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="currency-amount" class="form-label">Amount:</label>
                                    <input type="number" id="currency-amount" class="form-control" placeholder="100" min="0" step="any" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="from-currency" class="form-label">From:</label>
                                    <select id="from-currency" class="form-select">
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="INR" selected>INR - Indian Rupee</option>
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="GBP">GBP - British Pound</option>
                                        <option value="JPY">JPY - Japanese Yen</option>
                                        <option value="AUD">AUD - Australian Dollar</option>
                                        <option value="CAD">CAD - Canadian Dollar</option>
                                        <option value="CNY">CNY - Chinese Yuan</option>
                                        <option value="CHF">CHF - Swiss Franc</option>
                                        <option value="AED">AED - UAE Dirham</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="to-currency" class="form-label">To:</label>
                                    <div class="input-group">
                                        <select id="to-currency" class="form-select">
                                            <option value="USD" selected>USD - US Dollar</option>
                                            <option value="INR">INR - Indian Rupee</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - British Pound</option>
                                            <option value="JPY">JPY - Japanese Yen</option>
                                            <option value="AUD">AUD - Australian Dollar</option>
                                            <option value="CAD">CAD - Canadian Dollar</option>
                                            <option value="CNY">CNY - Chinese Yuan</option>
                                            <option value="CHF">CHF - Swiss Franc</option>
                                            <option value="AED">AED - UAE Dirham</option>
                                        </select>
                                        <button class="btn btn-outline-secondary" type="button" id="swap-currencies" aria-label="Swap currencies">
                                            <i class="fas fa-exchange-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex flex-wrap gap-2 mt-3">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-equals me-2"></i>Convert</button>
                                <button type="button" class="btn btn-outline-info" id="save-favorite">
                                    <i class="fas fa-star me-2"></i>Save Favorite Pair
                                </button>
                                <select id="favorite-pairs" class="form-select w-auto">
                                    <option value="">Favorites</option>
                                </select>
                            </div>
                        </form>
                        <div id="currency-result" class="result-box mt-3"></div>
                        <div id="currency-history" class="mt-3"></div>
                      </div>
                    </div>
                    <div class="recent-calculations">
                      <h4>Recent Conversions:</h4>
                      <ul id="recent-list">
                        <!-- Dynamically populated -->
                      </ul>
                    </div>

                    <!-- Financial Plot Container -->
                    <div id="financial-plot-container" style="display: none;">
                        <div id="financial-plot-loading" class="alert alert-info" style="display: none;">Generating plot...</div>
                        <canvas id="financial-plot-canvas" style="display: none;"></canvas>
                        <div id="financial-plotly-surface" class="plotly-surface" style="display: none;"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery for AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Chart.js for 2D plotting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Plotly.js for 3D plotting -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/financial-calc.js' %}"></script>
    <script src="{% static 'js/currency-converter.js' %}"></script>
    <script src="{% static 'js/math-keyboard.js' %}"></script>

    <!-- Math Keyboard Container (populated by math-keyboard.js) -->
    <div id="math-keyboard-container" style="display:none;"></div>

</body>
</html>
